[TOC]

# Hello!

我是哈工大21级CS的**耗材生**一个，这里是我的一些自用代码。

**如有需要，尽可自取；发现bug，欢迎联系。**

# mypath

`/mypath`里的内容是自写的一些代码程序，可以用做命令行命令。

> 本文中，命令行指Win的`cmd`、Linux的`Terminal`或者`Git Bash`。
> 
> 我比较喜欢后两者，美观。
>
> 有一些内容是只能用后两个运行的，如`ip.sh`及其配套程序。见谅。

**注意：**在获取代码之后（最好是放在同一文件夹下，方便对自己添加的命令进行管理和修改），先要把所属文件夹加入系统路径/用户路径，然后编译代码，才能在任意位置使用。改的时候，改完代码，编译，即可。

## header

程序[header.cpp](/mypath/header.cpp)用来给python的爬虫程序写请求头headers。用法如下：

- 在某个文件（以1.txt为例）中，把要爬取的信息的请求头复制下来，贴进去并保存。
- 在命令行中执行<kbd>header 1.txt</kbd>，可以看到当前文件夹下多了个`myheaders.py`。
- 在爬虫程序中，写入<kbd>from myheaders import *</kbd>，即把请求头导入，变量名为`headers`。直接使用即可。

## ip

已知，局域网可以用来部署临时服务器（对，服务器就是自己的电脑），方法如下：

### Live Server

首先，我们需要一个[VSCode](https://code.visualstudio.com/)（笑）。

在扩展中，搜索`Live Server`，安装本插件。安装完成后，可以看到右下角出现了一个信号塔一样的图标`Go Live`。

### 获取ip

在命令行中运行<kbd>ipconfig</kbd>，找到“无线局域网适配器WLAN”下写的“IPv4地址”，把后边的ip复制下来。

在VSCode中打开设置，搜索"Live Server:Settings:Host"，在找到的ip地址栏里把复制的内容贴上去。关闭设置。

在当前目录下写一个index.html。过程略。

此时，点击右下角`Go Live`，成功后就会在默认浏览器中打开当前目录的index.html。在本局域网（比如窝工全校范围）内，使用此网址均可访问（别的机子手机也可以哦）。而且VSCode右下角显示为`Port`。点击之，就会关闭Live Server，服务器停止，无法继续访问。

方法很好，有几个缺点：
- 每当关闭Live Server，或者关闭VSCode、断网、电脑关机，就相当于连不上服务器，无法访问。这是系统性缺陷。
- 每次系统断网或关机（关机不也是断网吗），ip就会改变，再次打开需要重新手动操作好久。这个可以解决。

### WTF does the ip.sh do?

所以[ip.sh](/mypath/ip.sh)是干什么的？就是用来代替手动操作的。ip.cpp和compare_ip_vsc.cpp是其辅助。

对于VSCode而言，绝大多数系统设置都写在安装目录下的`settings.json`中。找不到安装目录的话，在开始菜单找到VSCode，右键，打开文件所在位置，此时打开的是开始菜单所属的文件夹。然后再次找到它的快捷方式，右键，打开文件所在位置，就来到了安装目录。找一找，就看到了。

打开，会发现里边有一行正是在记录ip（如果没有，证明没有手动处理过，按照上边说的，手动处理一次）。

让我们回到`ip.sh`。使用之前，先要把第一行打开的路径修改为自己的默认settings.json所在地址（所有`\`改双斜杠`\\`）。在`ip.sh`所在文件夹双击执行之。（或者当前目录下右键git bash执行<kbd>bash ip.sh</kbd>。没有就下一个git。都是老程序猿了，git还是要用的。）

工作原理如下：
- ip.sh在进入settings.json文件夹后，执行了`ipconfig > ip.txt`命令，把ipconfg的输出写在了`ip.txt`中。
- ip.exe从`ip.txt`读出所需ip地址，把旧有的`settings.json`内容全部读取写入`new.txt`，并在此过程中识别出原有的ip地址（所以必须手动操作过一遍，保证里边有这个内容），更新为新的ip。
- conpare_ip_vsc.exe将原有`settings.json`与新建的`new.txt`进行比对。
  - 结果相同（除了ip之外），输出信息来说明比对正确，则删除settings.json和ip.txt，而后把new.txt重命名为settings.json，反正VSCode也看不出来被掉包了，是吧~
  - 结果不同，证明出了某些bug，输出报错，删除ip.txt和new.txt，保留旧的settings.json，保证安全。
- 在不同步骤之间加了2s停顿，方便人眼看到每一步的结果。

# 成绩？Python？

## 简介

顾名思义，这是一个利用Python爬虫获取窝工教务系统上自己成绩的东西。
- `scores.py`用来获取分学期的学生成绩和GPA计算（所有课都囊括在内，包括考查和选修）
- `gpa.py`获取“学分绩查询”中的内容，包括网站上输出的学校计算的学分绩、当前排名等信息，以及所有课的列表信息，并据此计算截至目前的总GPA（也是所有课在内）
- `fileop.py`提供文件处理操作，`myheaders`提供请求头，`mytime.py`提供当前时间（看总gpa总是需要时效，不是么）

爬虫代码就不说了，说说用法。

## 用法

前期准备：

- 我们需要一个[Pandoc](https://pandoc.org/)。下载完成后，把`pandoc.exe`所在文件夹加入系统路径。

- 我们又需要一个[Tex Live](https://www.tug.org/texlive/)。

这都是大学生必备工具，一个拿来转换文件格式还极度美观，一个拿来写论文尤其是毕业论文，不会还有人没有吧？不会吧不会吧？

爬取期末成绩时：
- 打开窝工教务处的期末成绩查询，按下<kbd>F12</kbd>，在出现的右侧栏的上边一栏中点击“网络”。在网页中随便查一下哪个学期成绩，在右侧找到html文件，单击，在出现的栏目中，把请求头内容全部复制下来。
- 打开`scores.py`所在文件夹，新建一个文件（如2.txt），请求头贴进去，保存退出。
- 打开命令行，执行<kbd>header 2.txt</kbd>（现在知道为啥要把mypath加系统路径了吧）。Python所需请求头就写好了，在`myheaders.py`中。不用管。
- 继续，执行`python scores.py`，按照提示输入即可。
  - 输入“学年学期”时，学年写完整，秋季学期1春季学期2。比如21秋就写<kbd>2021-20221</kbd>，23春（似乎还没有哈）就写<kbd>2022-20232</kbd>，以此类推。
  - 输入文件名，不需要后缀名。如：想输出为`22春.pdf`，写`22春`即可。
  - 耐心等待，直到成功。

爬取学分绩也是一样，只不过找请求头的位置变成了“学分绩查询”，执行的变成了`python gpa.py`。如是而已。

另外，如果出现F12的“网络”里什么都没有或者没出现html的话，直接在左边网页的右上角刷新一下网页。

所有的输出内容都在`res`文件夹中，而且**此文件夹即使为空也必须存在**，不可删除，否则运行时会报错。如果误删，新建一个叫`res`的文件夹便是。

# 其他

本人为需求催动，一戳一蹦跶。故**此仓库不定时更新，欢迎Star**。

本人QQ：3205135446

如果各位有什么好点子或建议，可不能独吞，来和我battle呀，一起学习。